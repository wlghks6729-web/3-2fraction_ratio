<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë˜‘ë˜‘ì´ ë¶„ìˆ˜ ì„ ìƒë‹˜ - 3í•™ë…„ ìˆ˜í•™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nanum Gothic', sans-serif;
            background-color: #e0f2fe; /* sky-100 */
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .font-jua {
            font-family: 'Jua', sans-serif;
        }
        /* ì±„íŒ…ì°½ ìŠ¤íƒ€ì¼ */
        .chat-container {
            width: 100%;
            max-width: 480px;
            height: 90vh;
            background-color: white;
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            border: 4px solid #93c5fd; /* blue-300 */
        }
        .header {
            background-color: #60a5fa; /* blue-400 */
            padding: 16px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between; /* ì–‘ë ì •ë ¬ ìœ ì§€ */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 10;
        }
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #f8fafc;
            display: flex;
            flex-direction: column;
            gap: 16px;
            scroll-behavior: smooth;
        }
        .bubble {
            max-width: 85%;
            padding: 14px 18px;
            border-radius: 20px;
            font-size: 16px;
            line-height: 1.6;
            word-break: keep-all;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            animation: slideUp 0.3s ease-out;
        }
        .bubble-bot {
            background-color: white;
            border-top-left-radius: 4px;
            color: #334155;
            align-self: flex-start;
            border: 1px solid #e2e8f0;
        }
        .bubble-user {
            background-color: #3b82f6; /* blue-500 */
            border-top-right-radius: 4px;
            color: white;
            align-self: flex-end;
        }
        .input-area {
            padding: 16px;
            background-color: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 8px;
        }
        
        /* ì‹œê°í™” ë° ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .fraction-display {
            font-family: 'Jua', sans-serif;
            background-color: #dbeafe;
            color: #1e40af;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 1.1em;
            display: inline-block;
            margin: 0 2px;
        }
        
        /* íŒíŠ¸ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .hint-container {
            margin-top: 10px;
            text-align: center;
            background-color: #fffbeb; /* amber-50 */
            border-radius: 12px;
            border: 2px dashed #fcd34d; /* amber-300 */
            padding: 10px;
            transition: all 0.3s ease;
        }
        .hint-step-text {
            font-size: 14px;
            color: #92400e; /* amber-800 */
            background-color: white;
            padding: 8px;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #fcd34d;
            text-align: left;
        }
        .hint-btn {
            background-color: #fbbf24; /* amber-400 */
            color: #78350f;
            font-family: 'Jua', sans-serif;
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 0 #d97706;
            transition: transform 0.1s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .hint-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }
        .hint-btn-blue {
            background-color: #60a5fa;
            color: white;
            box-shadow: 0 2px 0 #2563eb;
            margin-top: 8px;
        }
        .hint-btn-green {
            background-color: #4ade80;
            color: white;
            box-shadow: 0 2px 0 #16a34a;
            margin-top: 8px;
        }
        .visual-svg {
            display: block;
            margin: 10px auto;
            max-width: 100%;
            animation: fadeIn 0.5s;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

<div class="chat-container">
    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="header">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-2xl border-2 border-blue-200">
                ğŸ¦‰
            </div>
            <div>
                <h1 class="font-jua text-lg m-0 leading-tight">ë˜‘ë˜‘ì´ ë¶„ìˆ˜ ì„ ìƒë‹˜</h1>
                <span class="text-xs opacity-90">3í•™ë…„ ìˆ˜í•™: ë¶„ìˆ˜ë§Œí¼ ì•Œì•„ë³´ê¸°</span>
            </div>
        </div>
        <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì‚­ì œë¨ -->
    </div>

    <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
    <div class="messages" id="messages">
        <div class="bubble bubble-bot">
            ì•ˆë…•! ë‚˜ëŠ” ë¶„ìˆ˜ ì„ ìƒë‹˜ ë¶€ì—‰ì´ì•¼. ğŸ¦‰<br>
            ë‚˜ë‘ ê°™ì´ <b>(ë¶„ì) / (ë¶„ëª¨)</b> ë¬¸ì œë¥¼ í’€ì–´ë³¼ê¹Œ?<br>
            ì¤€ë¹„ëìœ¼ë©´ ì•„ë˜ <b>[ì‹œì‘]</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ì¤˜!
        </div>
    </div>

    <!-- ì…ë ¥ ì˜ì—­ -->
    <div class="input-area">
        <div id="start-btn-area" class="w-full">
            <button onclick="startGame()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-jua py-3 rounded-xl text-lg shadow transition-colors">
                ê³µë¶€ ì‹œì‘í•˜ê¸°! ğŸš€
            </button>
        </div>
        
        <div id="game-input-area" class="w-full flex gap-2 hidden">
            <input type="number" id="answerInput" placeholder="ì •ë‹µ ìˆ«ì ì…ë ¥" 
                class="flex-1 border-2 border-blue-200 rounded-xl px-4 py-2 font-jua text-lg focus:outline-none focus:border-blue-500 transition-colors"
                onkeypress="if(event.key === 'Enter') checkAnswer()">
            <button onclick="checkAnswer()" 
                class="bg-blue-500 hover:bg-blue-600 text-white rounded-xl w-14 flex items-center justify-center shadow transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                </svg>
            </button>
        </div>

        <div id="next-btn-area" class="w-full hidden">
            <button onclick="generateProblem()" class="w-full bg-green-500 hover:bg-green-600 text-white font-jua py-3 rounded-xl text-lg shadow transition-colors">
                ë‹¤ìŒ ë¬¸ì œ ì£¼ì„¸ìš”! ğŸ™‹
            </button>
        </div>
    </div>
</div>

<script>
    // ê²Œì„ ìƒíƒœ ë³€ìˆ˜
    let currentProblem = {};
    const objects = [
        { name: "íŒŒì´", unit: "ê°œ", emoji: "ğŸ¥§" },
        { name: "ë‹¨ì¶”", unit: "ê°œ", emoji: "ğŸ”˜" },
        { name: "í•´ë§ˆ", unit: "ë§ˆë¦¬", emoji: "ğŸŒŠ" },
        { name: "ì‚¬íƒ•", unit: "ê°œ", emoji: "ğŸ¬" },
        { name: "ì‚¬ê³¼", unit: "ê°œ", emoji: "ğŸ" },
        { name: "ë³„", unit: "ê°œ", emoji: "â­" },
        { name: "ê³µ", unit: "ê°œ", emoji: "âš½" }
    ];

    // DOM ìš”ì†Œ
    const msgContainer = document.getElementById('messages');
    const startBtnArea = document.getElementById('start-btn-area');
    const gameInputArea = document.getElementById('game-input-area');
    const nextBtnArea = document.getElementById('next-btn-area');
    const answerInput = document.getElementById('answerInput');

    // ë©”ì‹œì§€ ì¶”ê°€ í•¨ìˆ˜
    function addMessage(html, type) {
        const div = document.createElement('div');
        div.className = `bubble bubble-${type}`;
        div.innerHTML = html;
        msgContainer.appendChild(div);
        msgContainer.scrollTop = msgContainer.scrollHeight;
    }

    // SVG ì‹œê°í™” ìƒì„± í•¨ìˆ˜ (showNumbers ì˜µì…˜ ì¶”ê°€)
    function createVisualSVG(denom, num, unitValue, unit, showNumbers) {
        const size = 220;
        const radius = 90;
        const cx = size / 2;
        const cy = size / 2;
        
        let paths = '';
        let texts = '';

        for (let i = 0; i < denom; i++) {
            const startAngle = (i * 360 / denom) - 90;
            const endAngle = ((i + 1) * 360 / denom) - 90;
            
            const startRad = startAngle * Math.PI / 180;
            const endRad = endAngle * Math.PI / 180;

            const x1 = cx + radius * Math.cos(startRad);
            const y1 = cy + radius * Math.sin(startRad);
            const x2 = cx + radius * Math.cos(endRad);
            const y2 = cy + radius * Math.sin(endRad);

            const isSelected = i < num;
            const fillColor = isSelected ? '#93c5fd' : '#f1f5f9'; 
            const strokeColor = isSelected ? '#3b82f6' : '#cbd5e1'; 
            const textColor = isSelected ? '#1e3a8a' : '#64748b';

            let d;
            if (denom === 1) {
                d = `M ${cx}, ${cy-radius} A ${radius} ${radius} 0 1 1 ${cx} ${cy-radius-0.01} Z`;
            } else {
                const largeArc = (endAngle - startAngle > 180) ? 1 : 0;
                d = `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`;
            }

            paths += `<path d="${d}" fill="${fillColor}" stroke="${strokeColor}" stroke-width="2" />`;

            if (showNumbers) {
                const midAngle = (startAngle + endAngle) / 2;
                const midRad = midAngle * Math.PI / 180;
                const tx = cx + (radius * 0.6) * Math.cos(midRad);
                const ty = cy + (radius * 0.6) * Math.sin(midRad);
                
                // í…ìŠ¤íŠ¸ ìˆ˜ì •: ìˆ«ì + ë‹¨ìœ„ + "ì”©" (ì˜ˆ: "5ê°œì”©", "2ë§ˆë¦¬ì”©")
                texts += `<text x="${tx}" y="${ty}" font-family="Jua" font-size="12" fill="${textColor}" text-anchor="middle" dominant-baseline="middle" style="animation: fadeIn 0.5s">${unitValue}${unit}ì”©</text>`;
            }
        }

        return `
            <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" class="visual-svg">
                ${paths}
                ${texts}
            </svg>
        `;
    }

    // íŒíŠ¸ ë…¸ì¶œ í•¨ìˆ˜ (3ë‹¨ê³„ë¡œ í™•ì¥)
    window.revealHint = function(wrapperId, stage, denom, num, unitValue, unit, totalCount) {
        const wrapper = document.getElementById(wrapperId);
        if (!wrapper) return;

        // ë°ì´í„° íƒ€ì… ë³€í™˜
        denom = parseInt(denom);
        num = parseInt(num);
        unitValue = parseInt(unitValue);
        totalCount = parseInt(totalCount);

        if (stage === 1) {
            // 1ë‹¨ê³„: í…ìŠ¤íŠ¸ ë¹ˆì¹¸ íŒíŠ¸ (Oìœ¼ë¡œ ê°€ë¦¬ê¸°)
            wrapper.innerHTML = `
                <div class="hint-step-text">
                    <strong>[1ë‹¨ê³„] í’€ì´ ê³¼ì • ìƒê°í•˜ê¸°</strong><br>
                    ì „ì²´ <b>${totalCount}</b>ê°œë¥¼ <b>${denom}</b>ë¬¶ìŒìœ¼ë¡œ ë¬¶ìœ¼ë©´<br> 
                    í•œ ë¬¶ìŒì— <b class="text-red-500">O</b>${unit}ì”© ë¬¶ì…ë‹ˆë‹¤.<br>
                    ê·¸ ì¤‘ <b>${num}</b>ë¬¶ìŒì€ <b class="text-blue-600">O</b>${unit}ì…ë‹ˆë‹¤.
                </div>
                <button class="hint-btn hint-btn-blue" onclick="revealHint('${wrapperId}', 2, '${denom}', '${num}', '${unitValue}', '${unit}', '${totalCount}')">
                    ğŸ‘€ 2ë‹¨ê³„: ê·¸ë¦¼ íŒíŠ¸ (ëª¨ì–‘) ë³´ê¸°
                </button>
            `;
        } else if (stage === 2) {
            // 2ë‹¨ê³„: ê·¸ë¦¼ íŒíŠ¸ (ìˆ«ì X)
            const svg = createVisualSVG(denom, num, unitValue, unit, false);
            wrapper.innerHTML = `
                <div class="text-sm text-gray-600 mb-2 font-bold">â–¼ 2ë‹¨ê³„: ì „ì²´ë¥¼ ë¬¶ìŒìœ¼ë¡œ ë‚˜ëˆ„ê¸°</div>
                ${svg}
                <div class="text-xs text-blue-600 mb-2">ì „ì²´ë¥¼ ${denom}ì¹¸ìœ¼ë¡œ ë‚˜ëˆ„ê³  ${num}ì¹¸ì„ ìƒ‰ì¹ í–ˆì–´ìš”.</div>
                <button class="hint-btn hint-btn-green" onclick="revealHint('${wrapperId}', 3, '${denom}', '${num}', '${unitValue}', '${unit}', '${totalCount}')">
                    âœ¨ 3ë‹¨ê³„: ê·¸ë¦¼ íŒíŠ¸ (ê°œìˆ˜) ë³´ê¸°
                </button>
            `;
        } else if (stage === 3) {
            // 3ë‹¨ê³„: ê·¸ë¦¼ íŒíŠ¸ (ìˆ«ì O, "ê°œì”©" ì¶”ê°€ë¨)
            const svg = createVisualSVG(denom, num, unitValue, unit, true);
            wrapper.innerHTML = `
                <div class="text-sm text-gray-600 mb-2 font-bold">â–¼ 3ë‹¨ê³„: ë¬¶ìŒ ì•ˆì˜ ê°œìˆ˜ í™•ì¸</div>
                ${svg}
                <div class="text-xs text-blue-600 font-bold">í•œ ì¹¸ì— ${unitValue}${unit}ì”© ë“¤ì–´ìˆë„¤ìš”!<br>ìƒ‰ì¹ ëœ ì¹¸ì˜ ê°œìˆ˜ë¥¼ ëª¨ë‘ ë”í•´ë³´ì„¸ìš”.</div>
            `;
        }
    };

    function startGame() {
        startBtnArea.classList.add('hidden');
        addMessage("ì¢‹ì•„! ì²« ë²ˆì§¸ ë¬¸ì œë¥¼ ë‚´ì¤„ê²Œ.", 'bot');
        setTimeout(generateProblem, 600);
    }

    function generateProblem() {
        nextBtnArea.classList.add('hidden');
        gameInputArea.classList.remove('hidden');
        answerInput.value = '';
        answerInput.focus();

        const obj = objects[Math.floor(Math.random() * objects.length)];
        const denominator = Math.floor(Math.random() * 8) + 2;
        let numerator = Math.floor(Math.random() * (denominator - 1)) + 1;
        if (denominator === 2) numerator = 1;
        const multiplier = Math.floor(Math.random() * 5) + 1;
        const totalCount = denominator * multiplier;
        const answer = multiplier * numerator;

        currentProblem = {
            obj, totalCount, denominator, numerator, multiplier, answer
        };

        // íŒíŠ¸ ê³ ìœ  ID ìƒì„±
        const hintId = 'hint-' + Date.now();

        const questionHtml = `
            <div class="font-jua text-lg text-blue-700 mb-1">ë¬¸ì œ</div>
            ${obj.emoji} <b>${obj.name} ${totalCount}${obj.unit}</b>ì˜ <br>
            <span class="fraction-display">( ${numerator} ) / ( ${denominator} )</span> ì€(ëŠ”) 
            ${obj.name} ëª‡ ${obj.unit} ì¼ê¹Œìš”?
            
            <!-- íŒíŠ¸ ì˜ì—­ -->
            <div id="${hintId}" class="hint-container">
                <button class="hint-btn" onclick="revealHint('${hintId}', 1, '${denominator}', '${numerator}', '${multiplier}', '${obj.unit}', '${totalCount}')">
                    ğŸ’¡ íŒíŠ¸ ë³´ê¸° (í´ë¦­)
                </button>
                <div class="text-xs text-gray-400 mt-1">ì˜ ëª¨ë¥´ê² ë‹¤ë©´ íŒíŠ¸ë¥¼ ì—´ì–´ë³´ì„¸ìš”!</div>
            </div>
        `;

        addMessage(questionHtml, 'bot');
    }

    function checkAnswer() {
        const userVal = answerInput.value.trim();
        if (!userVal) return;

        addMessage(userVal, 'user');
        gameInputArea.classList.add('hidden');

        const userNum = parseInt(userVal);
        const p = currentProblem;

        if (userNum === p.answer) {
            addMessage(`ğŸ‰ <b>ì •ë‹µì…ë‹ˆë‹¤!</b><br>ì°¸ ì˜í–ˆì–´ìš”!`, 'bot');
            showExplanation();
        } else {
            addMessage(`ğŸ˜… <b>ì•„ì‰¬ì›Œìš”!</b><br>ì •ë‹µì€ <b>${p.answer}</b>${p.obj.unit}ì…ë‹ˆë‹¤.`, 'bot');
            showExplanation();
        }
    }

    function showExplanation() {
        const p = currentProblem;
        
        const explanation = `
            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 text-sm text-gray-700 mt-2">
                <div class="mb-2 pb-2 border-b border-dashed border-gray-300">
                    ì „ì²´ <b>"${p.totalCount}"</b>ê°œë¥¼ 
                    <b>"${p.denominator}"</b>ë¬¶ìŒìœ¼ë¡œ ë¬¶ìœ¼ë©´ <br>
                    í•œ ë¬¶ìŒì— ${p.obj.name} 
                    <span class="text-red-500 font-bold">"${p.multiplier}"</span>${p.obj.unit}ì”© ë¬¶ì…ë‹ˆë‹¤.
                </div>
                <div>
                    ê·¸ ì¤‘ <b>"${p.numerator}"</b>ë¬¶ìŒì€ <br>
                    ${p.obj.name} <span class="text-blue-600 font-bold text-lg">"${p.answer}"</span>${p.obj.unit}ì…ë‹ˆë‹¤.
                </div>
            </div>
        `;

        addMessage(explanation, 'bot');
        setTimeout(() => {
            nextBtnArea.classList.remove('hidden');
        }, 500);
    }
</script>

</body>
</html>
